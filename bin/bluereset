#/bin/bash

DEVICE_NAMES="kb-home.apgnet mt2.apgnet"

DEVICE_ADDRESSES=""
for name in ${DEVICE_NAMES} ; do
    DEVICE_ADDRESSES="${DEVICE_ADDRESSES} $(blueutil --paired --format json | jq -r ".[] | select(.name==\"${name}\") | .address")"
done


for address in ${DEVICE_ADDRESSES} ; do
    blueutil --unpair ${address}
done

sleep 4s

for address in ${DEVICE_ADDRESSES} ; do
    blueutil --pair ${address}
    blueutil --connect ${address}
done